#set($valueType = $property.type.qualifiedSourceName)
#set($parameterizedValueType = $property.type.parameterizedQualifiedSourceName)
#set($value = $property.variables.value)
#set($collectionImplementation = $TypeUtils.collectionImplementationFor($valueType))
#set($componentType = $property.type.isParameterized().typeArgs[0].parameterizedQualifiedSourceName)
#set($jsonValue = $property.variables.newVariable("JsonValue"))
#set($converter = $property.variables.newVariable("Converter"))

#logProperty()
$parameterizedValueType $value = null;
JSONValue $jsonValue = null;

#getOrSelectJsonValue()
if ($jsonValue != null)
{
    JSONArray jsonArray = ${jsonValue}.isArray();
    if (jsonArray != null)
    {
        int size = jsonArray.size();
        $value = new $collectionImplementation<$componentType>();
        Converter<$componentType> $converter = null;
        #if ($property.hasConverter())
            #customConverter() 
        #else 
            ## Temporarily set $valueType to $componentType to use #defaultConverter() macro   
            #set($valueType = $componentType)
            #defaultConverter()
            ## Switch back...
            #set($valueType = $property.type.qualifiedSourceName)
        #end
        for (int i = 0; i < size; i++)
        {
            JSONValue nestedJsonValue = jsonArray.get(i);
            if (nestedJsonValue != null && nestedJsonValue.isNull() == null) 
            {
                #set($valueBackup = $value)
                #set($propertyBackup = $property)
                #set($property = $property.child)
                #set($value = $property.variables.value)
                #parse($property.template)
				if ($value != null) 
				{
				    ${valueBackup}.add($value);
				}
            }
        }
    }
    ## Restore variables overwritten in nested template
    #set($property = $propertyBackup)
    #set($value = $valueBackup)
    if ($value != null) 
    {
        #assignValue()
    }
}
